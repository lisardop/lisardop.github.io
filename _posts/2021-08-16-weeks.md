---
layout: post
title: Code Period
subtitle: (7 Jun - 15 Aug 2021)
cover-img: /assets/img/path.jpg
thumbnail-img: /assets/img/thumb.png
share-img: /assets/img/path.jpg
gh-repo: daattali/beautiful-jekyll
tags: [SGoC2021, Aztec glyphs]
---

## WEEK 1
*7 - 13 JUN*

We had an online meeting with Mentors and decided split the project in two main areas:
- Machine Learning algorythm using TensorFlow, deploying by Tarun
- Server work and connectivity between the code and the Aztec glyphs app hosted in Uni. Oregon's servers (by me)

We have decided if we could have a functional prototype before the mid evaluation project.

Then, a local copy of all glyphs hosted in the Web app was provided by Stephanie for a first review. I get in contact with the server system admin Len for specifications and evaluating the best way for server connection without compromise data or files. All the project work would be dumped in U. Oregon's server.

The main concept for the project is:
- Integrate a form or end-user webpage for upload images.
- Provide images to the prototype via libraries or some kind of API.
- A prototype working with CPU (non-GPU).
- The result of prediction comes back to the user via webpage (Drupal Form API)
- New info and users images are stored in filesystem and DB tables.

## WEEK 2
*14 - 20 JUN*

I was in contact with Len, U. Oregon Admin Server for further specifications.
We need to deploy a development environment as follows:

- Create a Virtual Machine with 2 cores and 4 GB RAM.
- RedHat 7 Enterprise or CentOS for a non-GPU enviroment as OS.
- Do not reach more than 40 GB of virtual disk availability.

An initial Machine Learning protype via Google Colab was provided for the team by Tarun.

## WEEK 3
*21 - 27 JUN*

At this point and reviewed glyphs labels and storage, I started to do:

- Create a couple of VM with CentOS 7 and Ubuntu 20.4, just in case.
- Config a LAMP (Linux-Apache-MySQL-PHP) in them
- Install and config Drupal 8/9 structure for image info stored in the DB (MariaDB)


STARTING POINT:


~~~
VM: 2 cores; 4 GB RAM; 40 GB HD
Build Operating System (CentOS 7): 3.10.0-957.1.3.el7.x86_64
Root & adminuser accounts

- Pre-commands:
sudo yum update
reboot
~~~


CONFIG LAMP (as adminuser)

- MariaDB 10.5

~~~
sudo rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY*
sudo yum -y install epel-release

sudo tee /etc/yum.repos.d/MariaDB.repo<<EOF 
[mariadb]
name = MariaDB
baseurl = http://yum.mariadb.org/10.5/centos7-amd64
gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB
gpgcheck=1
EOF

sudo yum makecache fast
sudo yum -y install MariaDB-server MariaDB-client

sudo systemctl start mariadb
sudo systemctl enable mariadb

sudo mysql_secure_installation

/* set root pwd & enable root authentication */
~~~


- PHP 7.3.29


~~~
sudo yum -y install httpd

sudo systemctl start httpd.service
sudo systemctl enable httpd.service

sudo firewall-cmd --permanent --zone=public --add-service=http 
sudo firewall-cmd --permanent --zone=public --add-service=https
sudo firewall-cmd --reload

sudo rpm -Uvh http://rpms.remirepo.net/enterprise/remi-release-7.rpm
sudo yum -y install yum-utils

sudo yum-config-manager --enable remi-php73
sudo yum -y install php php-opcache

sudo systemctl restart httpd.service

sudo yum -y install php-mysqlnd php-pdo
sudo yum -y install php-gd php-ldap php-odbc php-pear php-xml php-xmlrpc php-mbstring php-soap curl curl-devel

sudo  systemctl restart httpd.service
~~~


- PHPMyAdmin 4.4.15.10


~~~
yum -y install phpMyAdmin
vi /etc/httpd/conf.d/phpMyAdmin.conf

/* replace:
  # Apache 2.4
  # <RequireAny>
  # Require ip 127.0.0.1
  # Require ip ::1
  # </RequireAny>
    Require all granted
 */
 
 systemctl restart  httpd.service
~~~


DRUPAL 9.2.1

~~~
sudo yum install -y policycoreutils-python wget

sudo wget --content-disposition https://www.drupal.org/download-latest/tar.gz
sudo tar xf drupal-9.2.1.tar.gz -C /var/www/html/

sudo mv /var/www/html/drupal-9.2.1/ /var/www/html/aztecglyphs
sudo chown -R apache: /var/www/html/aztecglyphs/sites/default/
sudo semanage fcontext -a -t httpd_sys_rw_content_t "/var/www/html/aztecglyphs/sites/default(/.*)?"
sudo restorecon -R /var/www/html/aztecglyphs/sites/default/

sudo yum install -y php-pecl-apcu php-gd php-mbstring php-opcache php-pecl-uploadprogress php-xml
sudo yum install -y php-mysqlnd

sudo systemctl reload httpd

sudo vi /etc/httpd/conf.d/aztecglyphs.conf

/* add:
<Directory /var/www/html/aztecglyphs>
    AllowOverride all
</Directory>
*/

sudo systemctl reload httpd
~~~

## WEEK 4
*28 JUN - 4 JUL*

This week I would prepare the structure of folders and DB objects, as in U. Oregon server

- The glyph images are hosted in /var/www/html/aztecglyphs/sites/default/files
- More accurated new glyphs was provided by Stephanie as a ZIP.
- I create a new database labeled: aztecglyphs
- I create the table for images info stored, labeled: file_managed

CREATE AZTECGLYPH DB

~~~
mysql -u root -p

MariaDB> create database aztecglyphs charset utf8mb4 collate utf8mb4_unicode_ci;
MariaDB> create user aztecglyphs@localhost identified by 'pwd';
MariaDB> exit
~~~


Open http://localhost/aztecglyphs
- Set "Standar" installation
- DB name: aztecglyphs
- DB user: aztecglyphs
- DB pwd: 'pwd'

Next step:
- Set Site name: aztecglyphs
- Site email: aztecglyphs@localhost
- Admin user: aztecadmin
- Admin pwd: 'pwd'

![Drupal](/assets/img/drupalaztecglyphs.jpg)


LOAD NEW GLYPH IMAGES IN DRUPAL FOLDER

![Glyphfiles](/assets/img/glyphfiles.jpg)


~~~
CREATE TABLE IF NOT EXISTS `file_managed` (
  `fid` int(10) unsigned NOT NULL COMMENT 'File ID.',
  `uid` int(10) unsigned NOT NULL DEFAULT '0' COMMENT 'The users.uid of the user who is associated with the file.',
  `filename` varchar(255) NOT NULL DEFAULT '' COMMENT 'Name of the file with no path components. This may differ from the basename of the URI if the file is renamed to avoid overwriting an existing file.',
  `uri` varchar(255) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL DEFAULT '' COMMENT 'The URI to access the file (either local or remote).',
  `filemime` varchar(255) NOT NULL DEFAULT '' COMMENT 'The fileâ€™s MIME type.',
  `filesize` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT 'The size of the file in bytes.',
  `status` tinyint(4) NOT NULL DEFAULT '0' COMMENT 'A field indicating the status of the file. Two status are defined in core: temporary (0) and permanent (1). Temporary files older than DRUPAL_MAXIMUM_TEMP_FILE_AGE will be removed during a cron run.',
  `timestamp` int(10) unsigned NOT NULL DEFAULT '0' COMMENT 'UNIX timestamp for when the file was added.',
  `type` varchar(50) NOT NULL DEFAULT 'undefined' COMMENT 'The type of this file.'
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='Stores information for uploaded files.';

--
-- Indexes for dumped tables
--

--
-- Indexes for table `file_managed`
--
ALTER TABLE `file_managed`
  ADD PRIMARY KEY (`fid`),
  ADD UNIQUE KEY `uri` (`uri`),
  ADD KEY `uid` (`uid`),
  ADD KEY `status` (`status`),
  ADD KEY `timestamp` (`timestamp`),
  ADD KEY `file_type` (`type`);

--
-- AUTO_INCREMENT for dumped tables
--

--
-- AUTO_INCREMENT for table `file_managed`
--
ALTER TABLE `file_managed`
  MODIFY `fid` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT 'File ID.';
~~~

## WEEK 5
*5 - 11 JUL*

This week I am going to import the updated model provided by Tarun.

- Install Anaconda 3 and possible libraries used by ML model.
- Export Colab notebook and import to Jupyter notebook.
- Have a success import Machine Learning model to the VM filesystem.
- Test if running is OK.

## WEEK 6 (First Evaluation)
*12 - 18 JUL*

x

## WEEK 7
*19 - 25 JUL*

x

## WEEK 8
*26 JUL - 1 AUG*

x

## WEEK 9
*2 - 8 AUG*

x

## WEEK 10
*9 - 15 AUG*

x

## AUG 16  ~ END;
