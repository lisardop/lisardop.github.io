---
layout: post
title: 2022 Code Period
subtitle: (13 Jun - 04 Sep 2022)
cover-img: /assets/img/path.jpg
thumbnail-img: /assets/img/thumb.png
share-img: /assets/img/path.jpg
gh-repo: daattali/beautiful-jekyll
tags: [SGoC2022, Aztec glyphs]
---

## WEEK 1 
*13 - 19 JUN*

We have a bunch of Codex Mendoza files from our previous GSoC project (more files are going to be added soon):
- Simplex (209): glyph is a whole unity
- Compound (364): glyph is a block of minor unities
- Atomic (714): minor unities isolated
- Iconography (12): another elements depicted, not logographyc glyphs but related
- Everything (1295): all previous files in same folder
- Augmented (6431): all glyphs of previous folder were shifted/rotate and generate an artificial expanded dataset made by Tarun.

![acatepecaugmented](/assets/img/Acatepec_augmented.jpg)

*This is an example of augmented compound glyph 'Acatepec'*

A successful match for the algorithm is determined by figure colours and its shape/position. We consider framing (250x250 or 500x500) a couple of testing images, with a small margin and transparent background or emulating light-brown paper (stored as PNG instead JPG/JPEG files to maintain transparency):

![ahuatepectransparentpaper](/assets/img/Ahuatepec_transparent_paper.jpg)

*Ahuatepec original glyph in JPG, and transparent and paper-color glyphs 500x500 stored as PNG extension*

Another problem we are dealing with is the optimal way to name files. Theoretically, the name of the file is irrelevant when the image is processed, but we want to link it to its glyphic value and with potential entries in Visual Lexicon.

There are two options for this task:
- Implement a way to obtain the info from the Drupal DB, with the cost of time and complexity that may arise.
- Extract from filenames so Python code can process it as a kind of metadata, print it on screen and build the web link for entries in the dictionary.

The second option could be something like this: name-type-pagination-source-extrainfo.png

I.E. : 

![ahuatloaktree](/assets/img/ahuatloaktree.jpg)

*ahuatl-atomic-21v-Mendoza-oaktree-Ahuatepec.png*

But we have the Visual Lexicon entries under this form: 

https://aztecglyphs.uoregon.edu/content/[ahuatl-21v](https://aztecglyphs.uoregon.edu/content/ahuatl-21v)

![ahuatlvisuallexicon](/assets/img/ahuatl_visual_lexicon.jpg)

or from other codices (AGN, Tierras, vol. 1871, exp. 1 = t18711):

https://aztecglyphs.uoregon.edu/content/[20-matl-t18711](https://aztecglyphs.uoregon.edu/content/20-matl-t18711)

So in our example, the 'real' image-related expected link is:

https://aztecglyphs.uoregon.edu/content/[ahuatl-21v](https://aztecglyphs.uoregon.edu/content/ahuatl-21v)

From there, there is an internal link to Online Nahuatl Dictionary:

![ahuatlvisuallexicondetail](/assets/img/ahuatl_visual_lexicon_detail.jpg)

https://nahuatl.uoregon.edu/content/[ahuatl](https://nahuatl.uoregon.edu/content/ahuatl)

![ahuatlOND](/assets/img/ahuatl_OND.jpg)

Another temporal solution should be just get the glyph name in the first filename position an establish a search-link, so user can check all available entries in Visual Lexicon:

https://aztecglyphs.uoregon.edu/fulltext-quick-search?search_api_views_fulltext=[ahuatl](https://aztecglyphs.uoregon.edu/fulltext-quick-search?search_api_views_fulltext=ahuatl)

![ahuatlsearch](/assets/img/ahuatl_search.jpg)


## WEEK 2
*20 - 26 JUN*

'Matrícula de Tributos' (ca. 1520-30) is a best candidate for expand the dataset (as we have so few examples of each glyph) but the algorythm showed a not so bad accuracity but failed when the same glyph was light or very dark colored. This is the main problem to deal with Matrícula de Tributos. It has 31 painted sheets of indigenous paper, amate (while Codex Mendoza, ca. 1540 was made of European paper). Some sheets of Matrícula de Tributos have lost some parts of the fibers and having a light-brown color due its antiquity and conservation. Although, some painted figures are partial lost or color-vanished, so we decided to edit them with software and get the most possible approach to its 'original' painting brightness.

These are some of our results using the free images available at [World Digital Library](https://www.loc.gov/resource/gdcwdl.wdl_03248/):

![MT1comp](/assets/img/MT_1comp.jpg)

*Matrícula de Tributos, sheet 1, very damaged*

![MT1comp29](/assets/img/MT_1comp29.jpg)

*Matrícula de Tributos, sheet 29. Black, green, blue and red are the most vanished*

Here, a quick example of a glyph cropped and compared with our previous dataset:

![Tecualoyanexamples](/assets/img/Tecualoyan_examples.jpg)

*Comparson between codices and digital treatments: A. Non-retouched glyph 'Tecualoyan' in Codex Mendoza; B. 'Tecualoyan' in 500x500 paper-color background; C. Non-retouched glyph 'Tecualoyan' in Matrícula de Tributos; D. Same glyph color-contrasted; E. Previous example cropped with a 500x500 paper-color background. F. Previous example mirrored.*


## WEEK 3
*27 JUN - 3 JUL*

Now, I am going to crop each figure from each Matrícula de Tributos' sheet, starting from left-up corner, going down and so on until the right-down corner. I crop all elements depicted (iconographic, glyphic or numerals).
But, each 'compound' or glyphic-block is cropped as a whole. Numerals presents in glyphs or iconography (as a graphic part) are cropped together with the main figure if they are visual integrated, as these examples:

![20shields](/assets/img/04_img15.png)

*20 number (pantli, as a white flag) in the top of a chimalli-shield*

![400blanquets](/assets/img/03_img26.png)

*400 (20x20) number (centzontli, as a kind of black hair comb) in the top of a white blanquet*

![8000paperbundle](/assets/img/05_img11.png)

*8000 (20x400) number (xiquipilli, as a white bag) under a paper bundle*

I will crop them in atomic glyphs later, but now total result is 849 main elements.

I am going to make a test before start removing peripheral details and determining which is the best type of background for a high match with the original dataset:

I choose two particular glyphs due to their similar shape between codices but one is color-vanished and another one is damaged. One is Ahuatepec glyph (Matrícula de Tributos, sheet 4) which is present in Codex Mendoza, 21v.

![Ahuatepec_MT](/assets/img/Ahuatepec_MT.jpg)

*Left: Ahuatepec in Matrícula de Tributos, sh.4. Right: Glyphs from Mendoza match-expected*

![Ahuatepec_originales](/assets/img/Ahuatepec_originales.jpg)

*These are the matching results with old datapump. As we can observe, Mendoza glyph matchs with itself. But Matrícula de Tributos example is light-colored and vanished and matches with a non-color, light-brown full background glyph*

Now, let's modify Ahuatepec glyph from Matrícula de Tributos.

![Ahuatepec_MTversions](/assets/img/Ahuatepec_MTversions.jpg)

*Some diferent backgrounds and artificial glyph colored (last one example is the most resembled to Mendoza's example)*

![Ahuatepec_comparson](/assets/img/Ahuatepec_comparson.jpg)

*As we can see, none of them match Ahuatepec or Ahuatl as in Mendoza (except the full-green glyph and white background in the 2nd -Ahuatl- and 4th position -Ahuatzitzinco- where they surprisingly coincide). Transparent or paper-colored backgrounds are the most accurated when the glyph has no artificial color. When artificially colored, the glyph matches other trees and plants in a 'cross' shape. Some water elements are present. Trees and tree-like plants are very difficult to distinguish, even for human eye due to the high complexity of peripheral elements, resulting in different names of trees or species.*

The other one is Oztoma (Matrícula de Tributos, sheet 1: partially damaged) but related with Oztotl in Codex Mendoza, 24v. And these are the glyphs match-expected:

![Oztotl](/assets/img/Oztotl_MT.jpg)

So, I modify damaged glyph Oztoma as previous Ahuatepec examples.

![Oztoma_MTversions](/assets/img/Oztoma_MTversions.jpg)

*Some modified Otzoma glyphs. Last one is artificial colored as expected*

And these are the results:

![Otzoma_comparson](/assets/img/Otzoma_comparson.jpg)

*As we can observe, none of them matched. Only last example, artificial colored, matches in 4th position with a frontal-face Otzotl with a hand in the right-top corner, but hand was erased from this test-example.*

## WEEK 4
*4 - 10 JUN*

These weeks, I am going to create glyph-files until Mid. Evaluation. I will try to do as much as I can, but trying at least to focus in toponymic glyphs.

![recortesMTejemplos](/assets/img/Recortes_MT_4_ejemplos.jpg)

*This is just an example after contrast, crop and paste in a 500x500 paper-like background (Matrícula de Tributos, sheet 4)*

## WEEK 5
*11 - 17 JUL*

Stephanie Wood send me a new datapump this week, stored by iconography, simplex, compound and atomic glyphs. Ignoring those repeated, there are 2012 image files, plus 62 digital painted glyphs.

![digitalOztotl](/assets/img/digital_Oztotl.jpg)

*Digital glyph Oztotol from new datapump*

![digitalOztotlcomparson](/assets/img/digital_Oztotl_comparson.jpg)

*Oztotol matches in previous datapump*

I am still cropping minor unit-glyphs, as it is a bit challenging crop vanished outlines.

## WEEK 6
*18 - 24 JUL*

I am finishing cropping Matrícula de Tributos and try to label each glyph with its proper name-value.
Meanwhile, I am finding glyphs from Osuna Codex (ignoring iconography by now).

I got 81 sheets from [Biblioteca Nacional de España](https://bdh-rd.bne.es/viewer.vm?id=0000049209&page=1).
This is an example of a sheet and its light-color provided by one of BNE versions:

![Osuna35r](/assets/img/Osuna35r.jpg)

*Osuna Codex, 35r*

![Osuna35rdetail](/assets/img/Osuna35r_detail.jpg)

*Osuna Codex, 35r, detail*

And this is the result after cropping and apply a 500x500 paper-colored background

![Ocelotepec35r](/assets/img/Ocelotepec_35r_v2.jpg)

*Left: Non-edit glyph Ocotepec, Osuna Codex 35r. Right: after edition*

When Ocelote head from Osuna Codex is tested with diferent backgrounds and enlargements, best match is centered with generous margings and white/transparent background.

![Ocelotecomparson](/assets/img/Ocelote_comparson.jpg)

*First ocelote head with a white background seems to be the most accurated. All its results are related with ocelote, but 2nd one is Ehecatl's face.*

Meanwhile, I prepare the new datapump from Mendoza Codex to upload. As soon as I finish Matricula de Tributos, all the files will be uploaded too.

## WEEK 7 Mentors and contributors can begin submitting Phase 1 evaluations
*25 - 31 JUN*

This week I am going to upload a new datapump from Matricula de Tributos, available [here]{https://www.dropbox.com/sh/q0ld6ir0r2n2pn7/AAAjLrmcFfLra2mOe4tE7EZRa?dl=0}

And mix it with previous GSoC2021 dataset from Mendoza and new additions provided by my mentor Stephanie Wood.

## WEEK 8
*1 - 7 AGO*

some tests

Now, I am going to get some results with a set of glyph names of Aztec rulers (Acamapichtli, Itzcoatl and Moctezuma Xocoyotzin). I am going to store them in "static/samples/" folder but not Medoza Codex examples. Mendoza Codex will be our "comparison tester", so that's why they are not included in test-dataset as the first results will be itself with a 100% of similarity. This will help us to find next "related" codex if we want to add more glyphs in future.

![Acamapichtliset](/assets/img/Acamapichtli_set.jpg)

This is the set of glyph names in diferent codex for Acamapichtli ruler (47 in total, but first and second are from Mendoza Codex, so 45 will be use as test-dataset). And these are the results:

![Acamapichtli](/assets/img/Acamapichtli_comparison.jpg)

*Acamapichtli02.jpg: 1. Clavijero (75%), 2. Codex Mexicain Depuis 1221 (71%), 3. Matrícula de Huexotzinco (71%), 4. Matrícula de Huexotzinco (70%), 5. Codex Vaticanus A (68%), 6. Matrícula de Huexotzinco (68%).*

*Acamapichtli01.jpg: 1. Clavijero (78%), 2. Matrícula de Huexotzinco (72%), 3. Tira de Tepechpan (70%), 4. Codex Vaticanus A (68%), 5. Matrícula de Huexotzinco (68%), 6. Matrícula de Huexotzinco (66%).*


![Itzcoatlset](/assets/img/Itzcoatl_set.jpg)

This is the set of glyph names in diferent codex for Itzcoatl ruler (48 in total, but 2nd and 3th are from Mendoza Codex, so 46 will be use as test-dataset). And these are the results:

![Itzcoatl](/assets/img/Itzcoatl_comparison.jpg)

*Itzcoatl CM 03.jpg: 1. Primeros Memoriales (79%), 2. Durán Codex (70%), 3. Ramírez Codex (70%), 4. Matrícula de Tributos "related codex" (69%), 5. Codex Mexicain Depuis 1221 (68%), 6. Durán Codex (68%).*

*Itzcoatl CM 02.jpg: 1. Primeros Memoriales (79%), 2. Durán Codex (73%), 3. Cozcatzin Codex (70%), 4. Durán Codex (69%), 5. Ramírez Codex (69%), Codex Vaticanus A (68%).*

![Motecuhzomaset](/assets/img/Motecuhzoma_set.jpg)

This is the set of glyph names in diferent codex for Moctezuma Xocoyotzin ruler (48 in total, but 9th is from Mendoza Codex, so 47 will be use as test-dataset). And these are the results:

![Motecuhzoma](/assets/img/Motecuhzoma_comparison.jpg)

*Motecuhzoma CM 09.jpg: 1. Codex Vaticanus A (66%), 2. Clavijero (65%), 3. Primeros Memoriales (63%), 4. Florentino Codex (62%), 5. Tlaloc Stone (62%), 6. Cozcatzin Codex (61%).*

We can observe how these Medoza Codex's glyphs are related with "Primeros Memoriales", "Clavijero - *Storia Antica...*", "Matrícula de Huexotzinco", "Durán Codex", "Codex Vaticanus A", "Florentino Codex", and even with "Matrícula de Tributos", a related codex we were working with in the first part of the project. Curiously, *Storia Antica* from Xavier Clavijero (a book from late-18th century and a fully european production) can easily be linked with Mendoza Codex, as many of its glyph-images matched at some point (and probably were inspired by Mendoza Codex).

Now, we are going to test all glyphs from Moctezuma Xocoyotzin (48) with full dataset (2725: Mendoza Codex and Matrícula de Tributos). But we are going to show here only those who matched with some visual attribute (in red) of his glyph name (diadem with/without noseplug/earplug, and long hair) that also is the regular glyph for "tecuhtli" (lord). As we know, Moctezuma is a spanish corruption for Mo-tecuh-zoma (original Aztec name) meaning "Our Angry Lord".

![Motecuhzomafull](/assets/img/Motecuhzoma_fullcomparison.jpg)

As we can observe only 9 of 48 (18.75%) show some visual attribute in its first six most closed results:

*- Motecuhzoma CM 09.jpg (Mendoza Codex): 1. Motecuhzoma (itself, 100%), 2. Cozcatecuhtlan (79%), 3. Izquemecan (due to "long hair", 77%), 4. ixtli (also due to "long hair", 77%), 5. Tecalco (76%), 6. tecuhtli (74%).*

*- Motecuhzoma CTR 10.jpg (Telleriano-Remensis Codex): 3. mecania (due to "diadem", 69%), 4. mecatl (also due to "diadem", 69%).*

*- Motecuhzoma MH 12.jpg (Matrícula de Huexotzinco): 3. Cozcatecuhtlan (from Matrícula de Tributos, 66%), 4. tecuhtli (from Matrícula de Tributos, 65%).*

*- Motecuhzoma PM 13.jpg (Primeros Memoriales): 3. Cozcatecuhtlan (64%), 4. Tecpan (645), 5. Tlacatecuhtli (64%).*

*- Motecuhzoma CF 23.jpg (Florentino Codex): 1. tecuhtli (57%).*

*- Motecuhzoma CTv 26.jpg (Tovar Codex): 1. tecuhtli (63%).*

*- Motecuhzoma CCo 40.jpg (Cozcatzin Codex): 4. tecuhtli (59%).*

*- Motecuhzoma CCo 41.jpg (Cozcatzin Codex): 4. tlacochtecuhtli (from Matrícula de Tributos, 69%).*

*- Motecuhzmoa CCo 43.jpg (Cozcatzin Codex): 6. tecuhtli (from Matrícula de Tributos, 70%).*

As expected Telleriano-Remensis, Matrícula de Huexotzinco, Primeros Memoriales, Florentino, Tovar and (in 3 cases of) Cozcatzin codex, show some visual attribute in the 6 most related glyphs.

## WEEK 9
*8 - 14 AGO*

changes from previous code version, added new code for link images with Visual Lexicon entries (search results). Got glyph name from filename, and convert consine distance into similarity percentage.

## WEEK 10
*15 - 21 AGO*

coding...

## WEEK 11
*22 - 28 AGO*

Provided (updated) a functional URL with new code and new dataset of images:

[Aztec Glyph Recognition App (v.2)](https://aztecglyphrecognition.herokuapp.com)

## WEEK 12
*29 AGO - 4 SEP*

- Report week

## SEP 5 ~ END;
*5 SEP - 12 SEP*

Contributor's final report
